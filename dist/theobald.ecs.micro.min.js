!function(){var e="theobald.ecs.micro",t=window.theobald||(window.theobald={});t.moduleName=e,function(){var e=window.theobald||(window.theobald={}),t=function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,n){if(t(e))for(var r=0;r<e.length;r++)n(e[r]);else n(e)}function r(e){var o="pending",i=[],a=[],s=[],c=null,u={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"resolved"===o&&n[r].apply(this,c),i.push(n[r]);else"resolved"===o&&arguments[e].apply(this,c),i.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"rejected"===o&&n[r].apply(this,c),a.push(n[r]);else"rejected"===o&&arguments[e].apply(this,c),a.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"pending"===o&&s.push(n[r]);else"pending"===o&&s.push(arguments[e]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(e){if(null==e)return u;for(var t in u)e[t]=u[t];return e},state:function(){return o},debug:function(){console.log("[debug]",i,a,o)},isRejected:function(){return"rejected"===o},isResolved:function(){return"resolved"===o},pipe:function(e,t,o){return r(function(r){n(e,function(e){"function"==typeof e?l.done(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(r.resolve,r.reject,r.notify):r.resolve(t)}):l.done(r.resolve)}),n(t,function(e){"function"==typeof e?l.fail(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(r.resolve,r.reject,r.notify):r.reject(t)}):l.fail(r.reject)})}).promise()}},l={resolveWith:function(e){if("pending"===o){o="resolved";for(var t=c=arguments.length>1?arguments[1]:[],n=0;n<i.length;n++)i[n].apply(e,t)}return this},rejectWith:function(e){if("pending"===o){o="rejected";for(var t=c=arguments.length>1?arguments[1]:[],n=0;n<a.length;n++)a[n].apply(e,t)}return this},notifyWith:function(e){if("pending"===o)for(var t=c=arguments.length>1?arguments[1]:[],n=0;n<s.length;n++)s[n].apply(e,t);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},d=u.promise(l);return e&&e.apply(d,[d]),d}r.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():r().resolve(e).promise()}return function(e){for(var t=r(),n=e.length,o=0,i=new Array(n),a=0;a<e.length;a++)!function(r){var a=null;e[r].done?e[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++o==n&&t.resolve.apply(t,i)}).fail(function(){t.reject(arguments)}):(a=e[r],e[r]=new Deferred,e[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++o==n&&t.resolve.apply(t,i)}).fail(function(){t.reject(arguments)}).resolve(a))}(a);return t.promise()}(arguments)},e.Deferred=r};t(e),e.newDeferred=function(){return new e.Deferred};var n=e.deferreds||(e.deferreds={});e.getDeferred=function(t){return n[t]||(n[t]=e.newDeferred())};var r=e.getDeferred("Ecs");e.ready=r.promise(),e.ready=e.ecsMicroReady=function(e){return r.done(e)}}();var n,r,o;!function(e){function t(e,t){return b.call(e,t)}function i(e,t){var n,r,o,i,a,s,c,u,l,d,f,p=t&&t.split("/"),g=v.map,h=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=e.split("/"),a=e.length-1,v.nodeIdCompat&&w.test(e[a])&&(e[a]=e[a].replace(w,"")),e=p.slice(0,p.length-1).concat(e),l=0;l<e.length;l+=1)if(f=e[l],"."===f)e.splice(l,1),l-=1;else if(".."===f){if(1===l&&(".."===e[2]||".."===e[0]))break;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||h)&&g){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),p)for(d=p.length;d>0;d-=1)if(o=g[p.slice(0,d).join("/")],o&&(o=o[r])){i=o,s=l;break}if(i)break;!c&&h&&h[r]&&(c=h[r],u=l)}!i&&c&&(i=c,s=u),i&&(n.splice(0,s,i),e=n.join("/"))}return e}function a(t,n){return function(){var r=x.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),p.apply(e,r.concat([t,n]))}}function s(e){return function(t){return i(t,e)}}function c(e){return function(t){m[e]=t}}function u(n){if(t(S,n)){var r=S[n];delete S[n],y[n]=!0,f.apply(e,r)}if(!t(m,n)&&!t(y,n))throw new Error("No "+n);return m[n]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return v&&v.config&&v.config[e]||{}}}var f,p,g,h,m={},S={},v={},y={},b=Object.prototype.hasOwnProperty,x=[].slice,w=/\.js$/;g=function(e,t){var n,r=l(e),o=r[0];return e=r[1],o&&(o=i(o,t),n=u(o)),o?e=n&&n.normalize?n.normalize(e,s(t)):i(e,t):(e=i(e,t),r=l(e),o=r[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},h={require:function(e){return a(e)},exports:function(e){var t=m[e];return"undefined"!=typeof t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:d(e)}}},f=function(n,r,o,i){var s,l,d,f,p,v,b=[],x=typeof o;if(i=i||n,"undefined"===x||"function"===x){for(r=!r.length&&o.length?["require","exports","module"]:r,p=0;p<r.length;p+=1)if(f=g(r[p],i),l=f.f,"require"===l)b[p]=h.require(n);else if("exports"===l)b[p]=h.exports(n),v=!0;else if("module"===l)s=b[p]=h.module(n);else if(t(m,l)||t(S,l)||t(y,l))b[p]=u(l);else{if(!f.p)throw new Error(n+" missing "+l);f.p.load(f.n,a(i,!0),c(l),{}),b[p]=m[l]}d=o?o.apply(m[n],b):void 0,n&&(s&&s.exports!==e&&s.exports!==m[n]?m[n]=s.exports:d===e&&v||(m[n]=d))}else n&&(m[n]=o)},n=r=p=function(t,n,r,o,i){if("string"==typeof t)return h[t]?h[t](n):u(g(t,n).f);if(!t.splice){if(v=t,v.deps&&p(v.deps,v.callback),!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},"function"==typeof r&&(r=o,o=i),o?f(e,t,n,r):setTimeout(function(){f(e,t,n,r)},4),p},p.config=function(e){return p(e)},n._defined=m,o=function(e,n,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(r=n,n=[]),t(m,e)||t(S,e)||(S[e]=[e,n,r])},o.amd={jQuery:!0}}(),o("../lib/almond/almond.js",function(){}),o("theobald.ajax",[],function(){function e(e,t,n){return!0}function t(t,n,r,o){return t.global?e(n||b,r,o):void 0}function n(e){e.global&&0===F.active++&&t(e,null,"ajaxStart")}function r(e){e.global&&!--F.active&&t(e,null,"ajaxStop")}function o(e,n){var r=n.context;return n.beforeSend.call(r,e,n)===!1||t(n,r,"ajaxBeforeSend",[e,n])===!1?!1:void t(n,r,"ajaxSend",[e,n])}function i(e,n,r){var o=r.context,i="success";r.success.call(o,e,i,n),t(r,o,"ajaxSuccess",[n,r,e]),s(i,n,r)}function a(e,n,r,o){var i=o.context;o.error.call(i,r,n,e),t(o,i,"ajaxError",[r,o,e]),s(n,r,o)}function s(e,n,o){var i=o.context;o.complete.call(i,n,e),t(o,i,"ajaxComplete",[n,o]),r(o)}function c(){}function u(e){return e&&(e==C?"html":e==E?"json":x.test(e)?"script":w.test(e)&&"xml")||"text"}function l(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function d(e){"object"===v(e.data)&&(e.data=p(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=l(e.url,e.data))}function f(e,t,n,r){var o="array"===v(t);for(var i in t){var a=t[i];r&&(i=n?r:r+"["+(o?"":i)+"]"),!r&&o?e.add(a.name,a.value):(n?"array"===v(a):"object"===v(a))?f(e,a,n,i):e.add(i,a)}}function p(e,t){var n=[];return n.add=function(e,t){this.push(T(e)+"="+T(t))},f(n,e,t),n.join("&").replace("%20","+")}function g(e){var t=Array.prototype.slice;return t.call(arguments,1).forEach(function(t){for(h in t)void 0!==t[h]&&(e[h]=t[h])}),e}var h,m,S=window.theobald||(window.theobald={}),v=function(e){return typeof e},y=0,b=window.document,x=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,E="application/json",C="text/html",j=/^\s*$/,F=function(e){var t=g({},e||{});for(h in F.settings)void 0===t[h]&&(t[h]=F.settings[h]);n(t),t.crossDomain||(t.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(t.url)&&RegExp.$2!=window.location.host);var r=t.dataType,s=/=\?/.test(t.url);if("jsonp"==r||s)return s||(t.url=l(t.url,"callback=?")),F.JSONP(t);t.url||(t.url=window.location.toString()),d(t);var f,p=t.accepts[r],S={},v=/^([\w-]+:)\/\//.test(t.url)?RegExp.$1:window.location.protocol,y=F.settings.xhr();t.crossDomain||(S["X-Requested-With"]="XMLHttpRequest"),p&&(S.Accept=p,p.indexOf(",")>-1&&(p=p.split(",",2)[0]),y.overrideMimeType&&y.overrideMimeType(p)),(t.contentType||t.data&&"GET"!=t.type.toUpperCase())&&(S["Content-Type"]=t.contentType||"application/x-www-form-urlencoded"),t.headers=g(S,t.headers||{}),y.onreadystatechange=function(){if(4==y.readyState){clearTimeout(f);var e,n=!1;if(y.status>=200&&y.status<300||304==y.status||0==y.status&&"file:"==v){r=r||u(y.getResponseHeader("content-type")),e=y.responseText;try{"script"==r?(1,eval)(e):"xml"==r?e=y.responseXML:"json"==r&&(e=j.test(e)?null:JSON.parse(e))}catch(o){n=o}n?a(n,"parsererror",y,t):i(e,y,t)}else a(null,"error",y,t)}};var b="async"in t?t.async:!0;y.open(t.type,t.url,b);for(m in t.headers)y.setRequestHeader(m,t.headers[m]);return o(y,t)===!1?(y.abort(),!1):(t.timeout>0&&(f=setTimeout(function(){y.onreadystatechange=c,y.abort(),a(null,"timeout",y,t)},t.timeout)),y.send(t.data?t.data:null),y)};F.active=0,F.JSONP=function(e){if(!("type"in e))return F(e);var t,n="jsonp"+ ++y,r=b.createElement("script"),o=function(){n in window&&(window[n]=c),s("abort",a,e)},a={abort:o},u=b.getElementsByTagName("head")[0]||b.documentElement;return e.error&&(r.onerror=function(){a.abort(),e.error()}),window[n]=function(r){clearTimeout(t),delete window[n],i(r,a,e)},d(e),r.src=e.url.replace(/=\?/,"="+n),u.insertBefore(r,u.firstChild),e.timeout>0&&(t=setTimeout(function(){a.abort(),s("timeout",a,e)},e.timeout)),a},F.settings={type:"GET",beforeSend:c,success:c,error:c,complete:c,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:E,xml:"application/xml, text/xml",html:C,text:"text/plain"},crossDomain:!1,timeout:0},F.get=function(e,t){return F({url:e,success:t})},F.post=function(e,t,n,r){return"function"===v(t)&&(r=r||n,n=t,t=null),F({type:"POST",url:e,data:t,success:n,dataType:r})},F.getJSON=function(e,t){return F({url:e,success:t,dataType:"json"})};var T=encodeURIComponent;return S.ajax=F,F}),o("theobald.util",[],function(){var e=window.theobald||(window.theobald={}),t=e.util||(e.util={});return t._extendInternal=function(e,t,n){var r,o={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},i=e,a=i;if(!i)return a;var s,c=arguments,u=0,l="number"==typeof n?2:c.length;for(l>2&&"function"==typeof c[l-1]&&(s=c[--l]);++u<l;)if(i=c[u],i&&o[typeof i])for(var d=-1,f=o[typeof i]&&Object.keys(i),p=f?f.length:0;++d<p;){var g;r=f[d],s?(g=s(a[r],i[r],r,a,i),void 0!==g&&(a[r]=g)):a[r]=i[r]}return a},t._extend=t._deepExtend=function(){var e=[].slice.call(arguments);return e.push(t._extendFilterDeep),t._extendInternal.apply(this,e)},t._extendSkipEmptyStrings=function(){var e=[].slice.call(arguments);return e.push(t._extendFilterDeepSkipEmptyStrings),t._extendInternal.apply(this,e)},t._merge=function(){return Array.prototype.slice.call(arguments,1).forEach(function(e){if(e)for(var n in e)null!==e[n]&&e[n].constructor===Object?obj[n]&&obj[n].constructor!==Object?obj[n]=e[n]:(obj[n]=obj[n]||{},t._merge(obj[n],e[n])):obj[n]=e[n]}),obj},t._extendFilterDeep=function(e,n){return"object"==typeof e&&"object"==typeof n?t._extendInternal(e,n,t._extendFilterDeep):void 0!==n?n:void 0!==e?e:void 0},t._extendFilterDeepSkipEmptyStrings=function(e,n){return"object"==typeof e&&"object"==typeof n?t._extendInternal(e,n,t._extendFilterDeepSkipEmptyStrings):void 0!==n&&(""!==n||void 0===e&&null===e)?n:e},t.format=function(e,t){return t="object"==typeof t?t:Array.prototype.slice.call(arguments,1),e.replace(/\{\{|\}\}|\{(\w+)\}/g,function(e,n){return"{{"==e?"{":"}}"==e?"}":t[n]})},t}),o("theobald.ecs",["theobald.ajax","theobald.util"],function(e,t){var n,r=window.theobald||(window.theobald={}),o=r.deferreds||(r.deferreds={}),i="Ecs",a=i.toLowerCase(),s={colonSpace:": ",empty:"",htmlLineBreak:"<br/>",literalLineBreak:"\n",literalNewLineReturn:"\r\n",slash:"/",space:" ",charZero:"0"},c=s.empty,u={sponline:!1},l=e,d=t,f=r.newDeferred;if(r[a])return r[a];r[i]=function(){};var p=r[i].fn=r[i].prototype;p.className=i,p.version="5.0.0",p.timeStamp="Thu Feb 04 2016 14:48:45 GMT+0100 (W. Europe Standard Time)",p.copyright="Theobald Software GmbH.",p.defaultConfig={behavior:{requestTimeout:6e4},connection:{ecs:{authenticate:c,core:c,coreApiKey:c,instance:c,queryLanguage:"EN",serviceApplication:c,useSharepointSettings:c,url:"/_vti_bin/ERPConnectServiceRest.svc/"}},configVersion:20},p.session={},p.localizableStrings={en:{ecsError:"There might be a problem with ECS",errors:{abort:"Request aborted.",ecsErrorExecuteFunction:"ECS tried to execute function but failed, please check connection integrity",ecsConnectionTestFailed:"Service connection test FAILED.",ecsSapConnectionTestFail:"SAP Connection FAILED.",genericSap:"Unknown SAP problem.",genericErrorTitle:"Something went wrong.",parametersName:"Function name not specified",parsererror:"Requested JSON parse failed.",sapErrorExecuteFunction:"Function execution failed with errors, please check ExecuteFunction Query",sapErrorCreateFunction:"Function's metadata could not be read, please check CreateFunction Query",sharepointApiKey:"Api-Key could not be read (SharePoint)",timeout:"Operation could not be completed. Slow connection or internal error.",urlNotProvided:"For ECSCore queries within SPOnline Url must be specified",unknownError:"Other error",wrongEcsLibrary:"If you intented to use tEcs with Sharepoint, please switch to theobald.ecs: https://static.theobald-software.com/theobald.ecs"},info:{ecsConnectionTested:"Service successfully tested.",ecscoreMode:"SPOnline detected, entering ECSCore mode.",ecsSapConnectionTested:"Connection with SAP system successfully tested.",aborted:"Process Aborted",credentialAdded:"User credentials added.",credentialDeleted:"User credentials removed.",credentialChecked:"User credentials are correct.",credentialCheckedFail:"User credentials are incorrect.",credentialFail:"Credentials could not be processed."},warnings:{scopeWithoutID:"tecs.scope: no scope ID",scopeNotDefined:"tecs.scope: closing scope without ID",xqlNotString:"tecs.executexql: query not a string.",chainNoQueue:"tecs.chain: no function queue."},sapError:"SAP Error",sapInfo:"SAP Information",sapValidation:"SAP Validation:\n{0}",sapWarning:"SAP Warning",unexpectedParameterFormat:"Possibly not supported data-type: '{0}' of structure at index {1}"},de:{ecsError:"Ein Problem mit ECS ist aufgetreten",errors:{abort:"Anfrage abgebrochen.",connectionOrRequest:"Verbindungsproblem oder inkorrekte Anfrage",ecsErrorExecuteFunction:"Die Funktion konnte von ECS nicht gesteuert werden, überprüfen Sie bitte die Signaturen aller Parameter (ExecuteFunction Query)",ecsConnectionTestFailed:"Der Verbindung zum Dienst ist fehlgeschlagen.",ecsSapConnectionTestFail:"Die SAP-Verbindung ist fehlgeschlagen.",genericSap:"Unbekannter SAP-Fehler.",genericErrorTitle:"Fehler",parametersName:"Bitte überprüfen Sie den Funktionsnamen",parsererror:"JSON-Parser Fehler.",sapErrorExecuteFunction:"Die SAP-Funktion wurde nicht ordnungsmäßig ausgeführt (ExecuteFunction Query)",sapErrorCreateFunction:"Die Metadaten der SAP-Funktion konnten nicht gelesen werden (CreateFunction Query)",sharepointApiKey:"Der Api-Key konnte nicht gelesen werden (SharePoint)",timeout:"Die Operation meldete sich nicht zurück. Langsame Verbindung oder ein interner Fehler.",urlNotProvided:"Geben Sie bitte ECSCore Endpoint ein (Url)",unknownError:"Unbekannter Fehler",wrongEcsLibrary:"Die erweiterte tEcs Version für SharePoint befindet sich unter: https://static.theobald-software.com/theobald.ecs"},info:{ecsConnectionTested:"Der Dienst wurde erfolgreich getestet.",ecscoreMode:"SPOnline: wechsele in den ECSCore-Modus.",ecsSapConnectionTested:"Die Verbindung zum SAP-System ist OK.",aborted:"Prozess wurde unterbrochen.",credentialAdded:"Benutzer wurde hinzugefügt.",credentialDeleted:"Benutzer wurde hinzugefügt.",credentialChecked:"Benutzerdaten wurden überprüft.",credentialCheckedFail:"Benutzerdaten sind falsch.",credentialFail:"SecureStore Fehler."},sapValidation:"SAP Validierung:\n{0}",sapWarning:"SAP Warnung",sapInfo:"SAP Information",sapError:"SAP Fehler",unexpectedParameterFormat:"Der Typ von '{0}' auf Index {1} in der Struktur möglicherweise nicht unterstützt"}},p.constants={actions:{BeginConnectionScope:"BeginConnectionScope",CreateFunction:"CreateFunction",EndConnectionScope:"EndConnectionScope",ExecuteFunction:"ExecuteFunction",ExecuteXQL:"ExecuteXQL",TestConnection:"Test",TestSAPConnection:"TestSAPConnection",AddCredentialToSecureStore:"AddCredentialToSecureStore",DeleteCredentialFromSecureStore:"DeleteCredentialFromSecureStore",CheckCredentialInSecureStore:"CheckCredentialInSecureStore",GetServiceApplicationInfoList:"GetServiceApplicationInfoList",CreateExecuteFunction:"CreateExecuteFunction",ExecuteInScope:"ExecuteInScope"},http:{contentTypeJson:"application/json; charset=utf-8"},messages:{tecsDone:"tecs.{0}.done",tecsFail:"ecs.{0}.fail",ecsDone:"ecs.{0}.done",ecsFail:"ecs.{0}.fail",sapDone:"sap.{0}.done",sapFail:"sap.{0}.fail",xhrDone:"xhr.{0}.done",xhrFail:"xhr.{0}.fail"},parameterDirection:{EXPORT:"export",IMPORT:"import",TABLES:"tables",CHANGINGS:"changings"},responses:{EndConnectionScopeOk:"OK"},sap:{functions:{BapiTransactionCommit:"BAPI_TRANSACTION_COMMIT",CrystalGetLogonLanguage:"/CRYSTAL/GET_LOGON_LANGUAGE"},errorCode:"E",warningCode:"W",dateFormat:"yyyyMMdd"},xql:{parameters:{language:"SPRAS = {0} ",languageDefault:"EN"},SELECT:"SELECT {0} ",select:function(e){return"SELECT "+e+" "},from:function(e){return"FROM "+e+" "},where:function(e){return"WHERE "+e+" "},and:function(e){return"AND "+e+" "},or:function(e){return"OR "+e+" "},top10:"TOP 10 ",FROM:"FROM {0} ",WHERE:"WHERE {0} ",LIKE:"LIKE {0}",like1parameter:"{0} LIKE '{{{0}}}% '",like2parameters:"({0} LIKE '{{{0}}}%' OR {1} LIKE '{{{0}}}%') ",OR:"OR {0} ",AND:"AND {0} ",nextParameter:"{0}, ",lastParameter:"{0} "}},n=p.constants.actions,p.stringify=function(e,t){var n;if(e.documentElement)return c;try{n=JSON.stringify(e,void 0,t?s.htmlLineBreak:2)}catch(r){n=c}return n},p.ajax=l,p._extendInternal=d._extendInternal,p._extend=p._deepExtend=d._extend,p._extendSkipEmptyStrings=d._extendSkipEmptyStrings,p._merge=d._merge,p._extendFilterDeep=d._extendFilterDeep,p._extendFilterDeepSkipEmptyStrings=d._extendFilterDeepSkipEmptyStrings,p.format=d.format,p.insureSlash=function(e){return e+(e.slice(-1)===s.slash?s.empty:s.slash)},p.getUrlWithProtocol=function(e){var t=e,n="https://";return 0!==e.indexOf("http")&&("/"===e[0]&&("/"===e[1]&&(this.warn("connection.ecs.url starts with two slashes"),t=t.substr(1)),t=t.substr(1)),t=n+t),t},p.getTimeout=function(e){var t=parseInt(e)&&e||parseInt(r.ecs.config.behavior.requestTimeout)&&r.ecs.config.behavior.requestTimeout||r.ecs.config.behavior.requestTimeout===!0&&6e4;return t},p.getWrapString=function(e,t){t||(t={});var n=t.html?s.htmlLineBreak:s.literalLineBreak,r=this.format("{0}:{1}",e,n);return r},p.getEcsAuthorization=function(e){if(!e)return this.error("apikey not specified"),s.empty;var t,n="APIKEY ";return"string"==typeof e&&(t=n+btoa(e)),t},p.executeAjaxRequest=function(e){function t(){var e=o(),t=f();return e.error?d.fail(T).reject(e.error):(e.error=function(){return t.reject.apply(t,arguments)},e.success=function(){return t.resolve.apply(t,arguments)},t.abort=function(e){d.__xhr.abort(e)},d.__xhr=l.ajax(e),d._deferred=t,d.deferred=d._deferred.promise(),d._deferred.then(F,T),d)}function n(e,t){return e.beforeSend=function(e){e.setRequestHeader("Authorization",t)},e.authToken=t,t}function o(){var t={};if(h=l.insureSlash(h)+(e.action||r.ecs.constants.actions.ExecuteXQL),h.indexOf(y)>-1&&(h=l.getUrlWithProtocol(h)),u.sponline&&h.indexOf(r.ecs.defaultConfig.connection.ecs.url)>-1)return t.error=r.ecs.strings.errors.urlNotProvided,t;if(w){var o="?";for(var i in w){var a=w[i];a&&(o+=encodeURIComponent(i)+"="+encodeURIComponent(a)+"&")}"&"===o.slice(-1)&&(o=o.slice(0,-1)),h+=o}if(c={url:h,type:S,data:e.rawData||l.stringify(C),dataType:m,contentType:v},b){var s;if(b===!0||"true"===b)if(e.authorization)s=e.authorization;else{if(!e.username||!e.password)return t.error="Basic Authorization requires username and password",t;s=btoa(e.username+":"+e.password)}s&&n(c,s)}else if(x){var d=l.getEcsAuthorization(x);n(c,d),c.authToken=d}return j&&(c.timeout=j),e.ajax&&l._extend(c,e.ajax),c}e||this.enull("parameters");var i={};try{i=this.session.connection.ecs}catch(a){}var c,l=this,d=f(),p=s.empty,g=this._extendSkipEmptyStrings({},this.config.connection.ecs,i,e.connection&&e.connection.ecs),h=e.url||g.url||p,m="json",S="POST",v=this.constants.http.contentTypeJson,y="servicebus.windows.net",b=e.authenticate||g.authenticate,x=e.coreApiKey||g.coreApiKey,w=e.urlParameters,E=e.useSharepointSettings||g.useSharepointSettings,C=e.data,j=r.ecs.getTimeout(),F=function(){return d.resolve.apply(d,arguments)},T=function(e){return clearTimeout(_),d.reject.apply(d,arguments),e};if(g&&g.core&&this._extend(c,{async:!0}),!(E&&r.sp&&window.SP))return t();var _;return d._deferred=r.sp.getEcsProperties(),d._deferred.then(function(e){return e.apikey&&(x=e.apikey),e.url&&(h=e.url),e.instance&&(w&&w.applicationName?w.applicationName=e.instance:e.instance&&(C.applicationName=e.instance)),t()},T),d.deferred=d._deferred.promise(),d},p.executeRequest=function(e){var t=this,n=f(),o=this._extend({},e),i=function(o){t.trace(t.format(t.constants.messages.xhrDone,e.action||"generic"));var i=t.getEcsError(o);if(i)return e.silent&&t.error(t.format(t.constants.messages.ecsFail+".silent %o",e.action||"generic"),o),n.reject(i,o),i;var a=r.ecs.unwrapResult(o);return n.resolve(a,o),a},a=function(o,i,a){var s;return"string"==typeof o?s=o:(s={xhr:o,textStatus:i,errorThrown:a},"notmodified"===i&&t.warn(i),s.message=r.ecs.getShortErrorMessage(s)),t.error("xhr.%s.fail: %o",e.action||"generic",s),n.reject(s),s};return n._deferred=this.executeAjaxRequest(o),n._deferred.then(i,a),n.deferred=n._deferred.promise(),n},p.executeEcsCommand=function(e,t){var n=this,o=this._extend({},e,{data:{}}),i=t||e.action,a=this.constants.actions,c=f(),u=function(t){n.trace(n.format("ecs.{0}.done",i));var r=t&&t.rows||t;return r=n.preprocessResult(e.preprocessResult,r),c.resolve(r,t),e&&(e.done||e.success)&&c.done(e.done||e.success),r},l=u,d=function(t){return n.error(n.format("ecs.{0}.fail: %o",i),t),n.lastError=t,c.reject(t),e&&(e.fail||e.error)&&c.fail(e.fail||e.error),t},p=d;e.action||(o.action=t),e.syncObject||(e.syncObject={});var g=function(t){var r=function(e){var t;try{t=e.connection.ecs.serviceApplication||e.connection.ecs.instance}catch(n){}return t},i=r(e)||r(n.session)||r(n.config);return i&&(o.data.applicationName=i,t&&(o.urlParameters||(o.urlParameters={}),o.urlParameters.applicationName=i)),o},h=function(){var t=e.syncObject&&e.syncObject.scope||e.scope;return t&&(o.data.connectionScope=t),o},m=function(e){return g(e),h()},S=function(){e.data?o.data=e.data:n._extend(o.data,{SecureStoreName:e.SecureStoreName,UserOrGroup:e.UserOrGroup,Username:e.Username,Password:e.Password})},v=function(e,t){u=function(t){return l(t),n.trace(e+s.space+"%o",t),t},d=function(e){return p(e),n.warn(t+s.space+"%o",e),e}};switch(i){case a.BeginConnectionScope:u=function(t){if(l(t),!t.id){var r=n.strings.warnings.scopeWithoutID;return n.warn(r),p(r)}return e.syncObject.scope=t,t},g(!0),0===Object.keys(o.data).length&&(o.data=s.empty);break;case a.CreateFunction:if(!o.data.name){var y=e.name||e.func;if(!y)return n.warn(n.strings.errors.parametersName),c.reject(n.strings.errors.parametersName);o.data.name=y}m();break;case a.EndConnectionScope:if(m(),!o.data.connectionScope){var b=n.strings.warnings.scopeNotDefined;return n.warn(b),c.reject(b)}u=function(e){return e===n.constants.responses.EndConnectionScopeOk?l(e):c.reject(e),e};break;case a.ExecuteFunction:e.data&&e.data["function"]&&e.data["function"].name?o.data=e.data:o.data={"function":e.sapFunctionObject||e.data},m();break;case a.ExecuteXQL:var x=e.data&&e.data.query||"string"==typeof e.data&&e.data||"string"==typeof e.query&&e.query;if("string"!=typeof x)return n.warn(n.strings.warnings.xqlNotString),c.reject(n.strings.warnings.xqlNotString);o.data.query=x,m();break;case a.TestConnection:v(n.strings.info.ecsConnectionTested,n.strings.errors.ecsConnectionTestFailed),g(!0);break;case a.TestSAPConnection:v(n.strings.info.ecsSapConnectionTested,n.strings.errors.ecsSapConnectionTestFail),g(!0);break;case a.AddCredentialToSecureStore:S(),v(n.strings.info.credentialAdded,n.strings.info.credentialFail);break;case a.DeleteCredentialFromSecureStore:S(),v(n.strings.info.credentialDeleted,n.strings.info.credentialFail);break;case a.CheckCredentialInSecureStore:S(),v(n.strings.info.credentialChecked,n.strings.info.credentialFail),u=function(e){l(t);var t,r="TRUE"===e;return t=r?n.strings.info.credentialChecked:r||"FALSE"!==e?"UNKNOWN":n.strings.info.credentialCheckedFail,n.trace(t+s.space+e),e};break;case a.Version:case a.Notifications:case a.Services:case a.ClearCaches:case a.ServiceBusConnectIfAutoRegisterIsEnabled:case a.ServiceBusDisconnect:var w="ecs command not implemented.";return this.warn(w),c.reject(w);default:var E="ecs command not defined.";return this.warn(E),c.reject(E)}return c._deferred=r.ecs.executeRequest(o),c.deferred=c._deferred.promise(),c._deferred.then(u,d),c};var g=function(e){return function(t){return this.executeEcsCommand(t,e)}},h={executeXql:n.ExecuteXQL,createSapFunction:n.CreateFunction,executeSapFunction:n.ExecuteFunction,beginConnectionScope:n.BeginConnectionScope,endConnectionScope:n.EndConnectionScope,testConnection:n.TestConnection,testSapConnection:n.TestSAPConnection,AddCredentialToSecureStore:n.AddCredentialToSecureStore,DeleteCredentialFromSecureStore:n.DeleteCredentialFromSecureStore,CheckCredentialInSecureStore:n.CheckCredentialInSecureStore};for(var m in h)p[m]=g(h[m]);return p.executeFunction=p.createAndExecuteSapFunction=function(e){var t=this,n=this._extend({},e),o=f(),i=function(){return o.reject.apply(this,arguments)},a=function(a){var s=e.data,c=s instanceof Function,u=c?0===s.length?r.ecs.assignFunctionParameters(s(),a):s(a):r.ecs.assignFunctionParameters(s,a),l=t._extend({},n);return l.data=u,o._deferred=t.executeSapFunction(l),o.deferred=o._deferred.promise(),o._deferred.then(function(){return o.resolve.apply(this,arguments)},i),o};return n.name||this.warn('sap function name not supplied (or legacy "func" usage).'),o._deferred=this.createSapFunction(n),o.deferred=o._deferred.promise(),o._deferred.then(a,i),o.then(function(t){return e.done&&e.done(t),t},function(t){return e.fail&&e.fail(t),t}),o.always(function(t){return e.always&&e.always(t),t}),o},p.executeChain=function(e){if(e.inScope)return delete e.inScope,this.executeInScope(e);var t=this,n=0,o=e.syncObject||(e.syncObject={}),i=this._extend({},e),a=f(),s=function(n){t.trace(t.format(t.constants.messages.tecsDone,t.constants.actions.ExecuteInScope)),e.done&&e.done(n)},c=function(n){t.trace(t.format(t.constants.messages.tecsFail,t.constants.actions.ExecuteInScope)),e.fail&&e.fail(n)},u=i.functions,l=function(t){return e.always&&e.always(t),delete o.cache,t},d=function(i){if(o.abort)return l(i),i;if(!u)return t.warn(t.strings.warnings.chainNoQueue),s&&s(i),a.resolve(t.strings.warnings.chainNoQueue),l(i),i;var f=u.shift();if(!f)return s&&s(i),a.resolve(i),l(i),i;var p=r.ecs._extend({connection:r.ecs._extend({},e.connection,f.connection)},f,{scope:o.scope}),g=function(e){if(f.done&&f.done(e),f.deferred&&f.deferred.resolve(e),f.name){var t=f.name||f.func,r=o.cache,i=n++;r[i]=e,r[i]._name=t}return d(e)},h=function(e){return f.fail&&f.fail(e),f.deferred&&f.deferred.reject(e),c&&c(e),l(e),e};return t.trace(f),f.query?(f.data||(f.data=f.query),a._deferred=t.executeXql(p)):a._deferred=t.createAndExecuteSapFunction(p),a.deferred=a._deferred.promise(),a._deferred.then(g,h),a};if(i.syncObject=o,o.cache={},e.commit){var p=u.slice(-1)[0].action;p===t.constants.actions.EndConnectionScope?u.splice(u.length-1,0,this.getCommitFunction()):u.push(this.getCommitFunction())}return d(),a},p.executeInScope=function(e){if(e.syncObject&&e.syncObject.scope&&!e.newScope)return this.executeChain(e);var t=this,n=f(),r=e.syncObject||(e.syncObject={}),o=this._extend({},e),i={connection:o.connection,syncObject:r},a=function(e){return n.reject(e),e};return o.syncObject=r,n._deferred=this.beginConnectionScope(i),n.deferred=n._deferred.promise(),n._deferred.then(function(e){n._deferred=t.executeChain(o),n._deferred.always(function(){return t.endConnectionScope(i)}),n.deferred=n._deferred.promise(),n._deferred.then(function(e){return n.resolve(e),e},a)},a),n},p.getCommitFunction=function(e){var t=this,n="commit",r=f(),o={name:this.constants.sap.functions.BapiTransactionCommit,_deferred:r};return o.deferred=r.promise(),r.then(function(e){return t.trace(t.format(t.constants.messages.ecsDone,n)),e},function(e){return t.error(t.format(t.constants.messages.sapFail,n)),e}),o},p.preprocessResult=function(e,t){var n=t;if(e)if(e instanceof Function)n=e(n);else for(var r in e)n=e[r](n);return n},p.assignFunctionParameters=function(e,t){function n(e,t){for(var r in e){var o=t[r],i=e[r];o&&(e[r]="object"==typeof o?n(i,o):o)}return e}var r=this;if(t||this.enull("metadata:sapFunctionObject"),!e)return t;var o=e.exports,i=e.tables,a=e.imports,s=e.changings,c=t.exports,u=t.tables,l=t.imports,d=t.changings,f=[o,a,s],p=[c,l,d];for(var g in f){var h=f[g],m=p[g];for(var S in h){var v=h[S],y=m[S];if(!y)return void r.warn("Invalid parameter will be skipped: "+S);var b=y.paramValue.values;b?n(b,v):y.paramValue=v}}for(var x in i)Array.prototype.push.apply(u[x].rows,i[x]);return t},p.unwrapResult=function(e){var t=e.result||e.Result||e.success||e.Success;return t},p.getConnection=function(e){return this._extend({},r.ecs.config.connection,e)},p.getXhrError=function(e,t){if(!e)return s.empty;t||(t={});var n=this,r=t.html?s.htmlLineBreak:String.fromCharCode(13),o=new RegExp(String.fromCharCode(13),"g"),i=e.error||e,a=i&&i.xhr,c=i&&i.textStatus,u=n.strings.errors[c],l=s.empty;if(a){if(u)l=u;else if(t["long"]){var d=i.errorThrown;l="XHR status: "+a.status+r+"textStatus: "+i.textStatus,d&&"string"==typeof d&&(l+=r+"errorThrown: "+t.html?d.replace(o,s.htmlLineBreak):d+r)}t&&t.wrap&&(l=n.getWrapString(n.strings.errors.connectionOrRequest,t)+l)}return l},p.getEcsError=function(e,t){if(!e)return s.empty;t||(t={});var n=new RegExp(this.format("{0}|{1}|{2}|{3}",String.fromCharCode(13),s.literalNewLineReturn,s.literalLineBreak,"\\\\r\\\\n"),"g"),r=e.error||e.Error||e,o=r.message||r.Message||s.empty;return t["long"]&&r.stackTrace&&(o=this.stringify(r)),o&&t.html&&(o=o.replace(n,s.htmlLineBreak)),o&&t.wrap&&(o=this.getWrapString(this.strings.ecsError,t)+o),o},p.getShortErrorMessage=function(e,t){if("string"==typeof e)return e;var n=e&&e.error||e,r="string"==typeof n?n:this.getEcsError(n,t)||this.getXhrError(n,t)||n&&n.title||this.strings.errors.genericErrorTitle;return r},p.getLongErrorMessage=function(e,t){if(!e)return s.empty;var n=e.error||e,r=t?s.htmlLineBreak:String.fromCharCode(13),o=s.empty,i={html:t,"long":!0,wrap:!0},a=this.getEcsError(n,i),c=this.getXhrError(n,i),u="{0}{1}";return o=this.format(u,a?a+r:s.empty,c)},p.getFullMessage=function(e,t){return r.ecs.getLongErrorMessage(e,t)},p.getLastError=function(){return this.lastError},p.popup=function(){return r.core&&r.core.popup?r.core.popup.apply(r.core,arguments):void alert("string"!=typeof arguments[0]||arguments[1]?this.stringify(arguments):arguments[0]);
},p.isAborted=function(e){return"abort"===e.textStatus?!0:!1},p.dateToString=function(e){return e.getFullYear?c+e.getFullYear()+(s.charZero+(e.getMonth()+1)).slice(-2)+(s.charZero+e.getDate()).slice(-2):(this.warn("not a date %o",e),e)},p.stringToDate=p.parseSapDate=function(e){return"string"!=typeof e?e:new Date(e.substr(0,4),parseInt(e.substr(4,2))-1,e.substr(6,2))},p.isSharepointOnline=function(){return window.location.host.indexOf("sharepoint.com")>-1},p.useSharepointSettings=function(e){return this.config.connection.ecs.useSharepointSettings=!0,e&&this.saveConfig(!1,!0),this.config.connection.ecs.useSharepointSettings},p.askSettingsAndSaveToSharepoint=function(e,t){return r.sp?r.sp.askSettingsAndSaveToSharepoint(e,t):this.warn("tEcs not supported, use theobald.ecs.js")},p.setSharepointSettings=function(){return r.sp?r.sp.setSharepointSettings.apply(r.sp,arguments):this.warn("please use full theobald.ecs library!")},p.wsdSoapQuery=function(e){e||this.enull("options");var t=this,n=e.namespace&&this.insureSlash(e.namespace)||"http://www.theobald-software.com/ERPConnectServices/WebServices/",o=e.url||this.format("/_vti_bin/{0}.svc",e.serviceName),i=e.interfaceName||"I"+e.serviceName,a=e.actionName||e.action||"GetServiceInfo",c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://www.theobald-software.com/ERPConnectServices/WebServices"><soapenv:Header/><soapenv:Body><web:{0}>{1}</web:{0}></soapenv:Body></soapenv:Envelope>',u=function(e){if(!e)return"";var n="<web:{0}>{1}</web:{0}>",r=s.empty;for(var o in e){var i=e[o],a=typeof i;if(i.indexOf("'")>-1&&t.warn("Soap Parameter has quote-sign."),"object"===a)r+=t.format(n,o,u(i));else if("array"===a)for(var c in i)r+=t.format(n,o,i[c]);else r+=t.format(n,o,i)}return r},l={contentType:"text/xml; charset=utf-8",headers:{SOAPAction:n+this.insureSlash(i)+a},type:"POST",url:o},d=function(n,r){t.log("Service OK"),e.done&&e.done(n,r)},f=function(n,r,o){t.error("Service ERROR: %s, %o",r,o),e.fail&&e.fail(n,r,o)};l.data=this.format(c,a,u(e.data)),this._extend(l,e.ajax);var p=r.$.ajax(l).done(d).fail(f);return e.always&&p.always(e.always),p},p.getSapLogonLanguage=function(e){return this.executeFunction(this._extend({name:this.constants.sap.functions.CrystalGetLogonLanguage},e))},r.ecs=new r[i],p.isSharepointOnline()&&(u.sponline=!0),p.initialize=function(){r.ecs.config=r.ecs.defaultConfig,r.ecs.strings=r.ecs.localizableStrings.en;var e=function(){var e=arguments[0],t=r.ecs.className+s.colonSpace;r.ecs.extendedLogger&&r.ecs.extendedLogger(arguments),"string"==typeof e&&(e=t+e),console.log.apply(console,arguments)};r.ecs._extend(r.ecs,{trace:e,debug:e,info:e,warn:e,error:e,enull:function(t){e("undefinedParameter: "+t)}}),o.Ecs.resolve()},window.tEcs=r.ecs,"theobald.ecs.micro"===r.moduleName?p.initialize():(o.Core||(o.Core=r.newDeferred()),o.Core.done(function(){r.core.initModule(r[a],function(){u.sponline&&!r.ecs.config.connection.ecs.core&&(r.ecs.config.connection.ecs.core=!0,r.ecs.saveConfig(!1,!0),r.core.getDeferred("Log").done(function(){r.ecs.info(r.ecs.strings.info.ecscoreMode)}))})})),r[a]}),o("theobald.ecs.micro.js",function(){}),r(["theobald.ecs"])}();